## 1 | 我一次最多能接收多少文件？

* **最佳实践**：一次上传 **≤ 10 个文件** 体验最流畅；超过 10 个文件解析速度会明显变慢，且容易触发平台超时或大小限制。
* **硬性上限**：实际上平台可接受的总文件数和大小取决于会话剩余 token 和后台限额——如果必须一次性传更多文件，请分批上传并在每批结束时告诉我哪些内容最关键，以便我优先处理。

---

## 2 | 在现有“2 层 6 角色”RBAC 里引入 **“企业会员”** 的可行性

| 角色层     | 当前 6 角色                                          | 典型权限       | 新“企业会员”需求                     |
| ------- | ------------------------------------------------ | ---------- | ----------------------------- |
| **后台层** | `Super Admin` / `Staff Admin` / `Staff Operator` | 运营、内容、系统管理 | **无变动**                       |
| **前台层** | `Premium Member` / `Registered User` / `Guest`   | 课程购买、会员权益  | • 单位付费<br>• 多席位管理<br>• 企业统计报表 |

> 现行 PRD 明确要求 **保持“2 层 6 角色”起步**，避免过度设计 。这意味着：
>
> * **角色数量固定**，权限通过“动作级 + 对象级”动态控制；
> * **高级会员类型**（月/季/年/长期）是“会员权益系统”层面的 **订阅等级**，而非新的 RBAC 角色 。

### ➜ 结论：**短期不必新增角色，使用现有 `Premium Member`**

1. **权限一致**：企业学员的课件访问范围往往与普通付费会员相似——都只涉及“前台层”资源。
2. **差异点在“计费与席位”**：可通过 **Membership / Subscription** 子系统存储 `membership_type = enterprise`、`seat_quota` 等字段，而无需 RBAC 角色膨胀。
3. **运维简单**：继续遵循“先简后繁”策略，降低测试与审核复杂度。

### ➜ 何时需要正式拆分为第 7 角色？

| 触发条件                | 具体场景                 | 推荐动作                                                              |
| ------------------- | -------------------- | ----------------------------------------------------------------- |
| 企业付费用户需要 **后台管理视角** | 例如查看公司学员进度、统一开票、批量购买 | 创建 **`Enterprise Admin`（后台层）**，继承 `Staff Operator` 部分查看权限，新增企业域过滤 |
| 企业课程需 **专属或提前访问**   | 企业定制课、B2B 合同课        | 在权限表中给课程打 `enterprise_only` 标签，或新增对象级权限                           |
| 需要 **企业专属运营功能**     | API 接入、SLA 服务、企业社群   | 通过 Feature Flag 或 ABAC 条件（`user.subscription == enterprise`）开启    |

---

## 3 | 如何在代码层留足 **“随时可扩展”** 的底层基础？

1. **面向数据库配置**

   ```python
   # models/role.py
   class Role(models.Model):
       slug = models.CharField(unique=True)   # 'premium_member', 'enterprise_member'
       name = models.CharField()
       level = models.PositiveSmallIntegerField(default=20)  # 留空档方便插入
   ```

   * 角色存表而非硬编码，可随时 `INSERT` 新角色。
   * `level` 越小权限越高（例如 0 = Super Admin）。

2. **权限映射使用枚举 + 中间表**

   ```python
   class Permission(models.Model):
       code = models.CharField(unique=True)   # 'course.view', 'org.report.view'
   class RolePermission(models.Model):
       role = models.ForeignKey(Role)
       perm = models.ForeignKey(Permission)
   ```

   * 新角色只需填充映射表，无需改代码。

3. **对前端封装统一 Hook**

   ```ts
   const can = usePermission();   // can('course.view')
   if (can('org.report.view')) showEnterpriseDashboard();
   ```

   * 后端返回 `permissions: ['org.report.view']`，前端无需感知角色细节。

4. **对象级扩展**

   * 采用 `django-guardian`，让企业角色仅能访问本企业对象；
   * 日后可对 `Course`、`Report`、`User` 等模型动态分配权限。

5. **ABAC / Feature Flag**

   * 对“席位数”“高级报表”此类差异，用 **属性驱动** 而非角色驱动：

     ```python
     if request.user.subscription == 'enterprise' and user.seats_left():
         ...
     ```

---

## 总结

* **文件上传**：一次建议 ≤ 10 个；分批更稳。
* **企业会员**：短期可直接继承 `Premium Member`，逻辑写在订阅系统而非 RBAC；如未来出现后台管理、专属功能需求，再升级为第 7 角色。
* **代码设计**：使用“角色表 + 权限表 + ABAC/Feature Flag”，保持松耦合，未来无痛扩展。

---

### In short（中文极简版）

* **文件**：一次 ≤ 10 个最稳。
* **企业会员**：先当作 `Premium Member`，不同点写在订阅等级；真需专属后台时再加角色。
* **代码**：角色、权限都放数据库 + ABAC，可随时扩展，无需改核心代码。
-----------------------------------------------------------------
### 最小 MVP 里要不要写“企业会员”完整代码？

**结论：** **不要**。在 MVP 阶段只需把 RBAC 和会员系统设计得 **可扩展**，先交付“2 层 6 角色+普通会员”即可，等真正有 B2B 需求时再接入企业会员逻辑。

---

## 1. 为什么 MVP 先不实现企业会员

1. **PRD 明确范围**：MVP 需落地 **“2 层 6 角色”** 权限框架来替代旧的 9 角色设计 。
2. **数据迁移脚本**：初始 migration 只插入这 6 个核心角色 。
3. **可扩展性已预留**：RBAC 目标里写明“支持未来业务扩展”——多机构、多品牌、多角色 。
4. **团队资源聚焦**：MVP 关键指标在验证核心付费转化（月/季/年会员）和课程权限，企业侧客单价虽高但需要额外的后台、计费、席位管理，不宜分散资源。

---

## 2. 最小代码骨架怎么写，才能以后轻松加“企业会员”

| 层级        | 本期必须实现                                                   | 为企业会员预留                                                                                                         |
| --------- | -------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| **数据层**   | `Role`, `Permission`, `RolePermission` 四表；6 角色初始数据       | 在 `Role` 表留 **slug** 字段（如 `enterprise_member`），`level` 预留序号空挡；在 `Subscription` 表增加 `seat_quota`、`org_id` 等可为空字段 |
| **业务层**   | 登录→JWT→`RBACService` 检查                                  | 在 `RBACService` 里写 **扩展点接口**，允许自定义策略（如按组织过滤）                                                                    |
| **会员系统**  | 个人订阅（月/季/年/长期）计费 + 权益                                    | 设计枚举 `membership_type`；当值为 `enterprise` 时触发席位逻辑，但先不实现                                                           |
| **前端**    | `usePermission()` + `PermissionGate` 组件；Pinia RBAC store | 在组件中集中读取 `permissions[]`，避免写死角色判断；未来企业后台只需返回新权限                                                                 |
| **CI/CD** | 自动生成 6 角色种子数据、单元测试通过                                     | 预留 SQL/JSON 模板，后续插入 Enterprise 角色时复用同一脚本格式                                                                      |

---

## 3. 未来接入企业会员的增量工作（估算：后端 3 d + 前端 2 d）

1. **数据库**：`INSERT INTO role (...) VALUES ('enterprise_member', …)`；在 `Subscription` 表写 `membership_type='enterprise'` 并填 `seat_quota`。
2. **权限映射**：往 `RolePermission` 表批量插入企业专属权限（如 `org.report.view`）。
3. **后端策略**：扩展 `RBACService→get_scope()`，企业用户默认只看 `org_id` 匹配的数据。
4. **计费**：在 Stripe/支付宝企业版里配置 **包年+席位包** SKU，加一条 `Webhook` 将 `seat_quota` 写回 `Subscription`。
5. **前端**：在企业后台入口处加 `v-permission="'org.report.view'"`；Dashboard 使用 `org_id` 拉取报表。

---

## 小结

* **MVP 阶段重点**：交付 6 角色 + 个人会员转化；企业会员先不做。
* **技术策略**：用 **表驱动 + Service 扩展点 + Feature Flag**，确保以后“一插即用”。
* **未来扩展**：增量插入角色、权限、订阅类型即可，无需改动核心代码。

---

### In short（中文简述）

MVP 只落地 6 角色和个人会员，把角色、订阅做成数据库可配置 + Service 扩展点。以后想加企业会员，只需插入一行新角色、补几条权限与订阅配置即可，无需重构。
