# 会员专区与课程对齐技术方案（Claude Code 执行手册）

## 1. 技术目标
- 保持三级课程体系并统一 stage/tag 展示，消除旧“免费/付费”文案。【F:frontend/AGENTS.md†L45-L76】
- 在不依赖后端的前提下，前端完成会员专区展示、会员专享课程插入、Program 页面 JSON-LD 完整化。

## 2. 代码范围与约束
- 仅修改 `/frontend/src` 内组件、store、utils 与路由；mock 数据自给自足，不调用后端 API。【F:frontend/docs/1120前端课程重构资料/03 课程体系重构PRD.md†L1-L88】
- 保持 Vue3 + TS + Bootstrap；所有 `<script>` 使用 `<script setup lang="ts">`；路径使用 `@/` alias。【F:frontend/AGENTS.md†L9-L36】

## 3. 数据模型与常量
- `STAGES`、`StageKey`、`LEGACY_STAGE_MAP` 已在 `src/types/index.ts` 定义，不可改回旧值。【F:frontend/AGENTS.md†L66-L70】
- 会员专享课程字段建议：
  - `audienceType: '会员专区'`
  - `offers`: `{ price, priceCurrency: 'CNY', availability: 'https://schema.org/InStock', membershipPrice?: number, discountPercent?: 10 }`
  - `isVipExclusive: true`（新增布尔字段时需同步类型定义）
- 新增 10 门会员专享课应放入 `src/store/courseStore.ts` 的 mock 数据，复用 `migrateCourseStages` 生成 slug 与 stage 映射。【F:frontend/AGENTS.md†L69-L70】【F:frontend/docs/1120前端课程重构资料/03 课程体系重构PRD.md†L25-L60】

## 4. 组件改造要点
### 4.1 StageTabs
- 依赖 `STAGES` 循环渲染三档按钮，并保留会员专区按钮；切换时写入 `currentStage` 和 `showVipZone`（如已有）。
- 点击会员专区：切换到 `showVipZone=true`，并让课程列表过滤到 `stage==='intermediate' || audienceType==='会员专区'`。

### 4.2 CampSection
- 默认 `currentStage` 为 `basic`，过滤逻辑支持 `program` 查询参数；新增对 `audienceType==='会员专区'` 的判断以覆盖会员专享课。【F:frontend/AGENTS.md†L71-L75】
- 若存在 JSON-LD 输出位，增加 `courseMode/audience/offers` 片段。

### 4.3 CourseCard
- 展示标签由 `getStageLabel(course.stage)` 生成；禁止直接使用旧 level 文案。【F:frontend/AGENTS.md†L72-L75】
- 若 `audienceType==='会员专区'`：
  - 显示会员徽标与高价/会员价对比；
  - offers 显示 `price`、`membershipPrice` 或 9 折价（Advanced 时）。
- 对应样式可复用现有 levelStyle 占位或新增 `vip` 样式 token。

### 4.4 LessonRow
- 检查是否仍有“免费/付费”字样，如有改成 `getStageLabel(stage)` 或显示“会员专区”；保持键盘交互不变。【F:frontend/AGENTS.md†L71-L73】

### 4.5 Program A/B
- Program A：过滤 `stage==='intermediate' || audienceType==='会员专区'` 课程；JSON-LD 设置 `audienceType: '会员专区'` 与 `offers.category='Membership'`。
- Program B：过滤 `stage==='advanced'`；`offers.category='Retail'`，并在 `priceSpecification` 中标明 `eligibleCustomerType='Member'`、`price` 为 9 折价。
- 路由文件保持新增路由位置在 NotFound 前，沿用现有 meta title/description 模式。【F:frontend/AGENTS.md†L66-L70】

## 5. JSON-LD 输出规范
- 课程页：
  - Level：DefinedTerm（Level 1/2/3）。【F:frontend/docs/1120前端课程重构资料/02 doviai课程五维设置说明.md†L12-L53】
  - Type：`@type: 'Course'`，`educationalUse` 取 Lesson/Exercise/Project 等。【F:frontend/docs/1120前端课程重构资料/02 doviai课程五维设置说明.md†L55-L86】
  - Access：`offers` 写 price/discount，`audience` 写会员专区或公开，`courseMode='Online'`。【F:frontend/docs/1120前端课程重构资料/02 doviai课程五维设置说明.md†L88-L129】
  - Outcome：每课 2-4 条学习结果短句。【F:frontend/docs/1120前端课程重构资料/02 doviai课程五维设置说明.md†L131-L165】
  - Pathway：`isPartOf` 指向 Program A/B；Program 页用 `hasCourse/hasPart` 回指。【F:frontend/docs/1120前端课程重构资料/02 doviai课程五维设置说明.md†L167-L213】
- Program 页：`@type: 'EducationalOccupationalProgram'`；Program B 增加 `occupationalCredentialAwarded` 字段。【F:frontend/docs/1120前端课程重构资料/03 课程体系重构PRD.md†L157-L220】

## 6. 任务清单（可直接执行）
1. 在 `courseStore` 增加 10 门会员专享课数据并设置 audience/offers 字段，跑 `migrateCourseStages` 以获得新 slug。
2. 更新 `StageTabs`、`CampSection` 过滤逻辑，确保会员专区显示 Intermediate + 会员专享课。
3. 调整 `CourseCard`/`LessonRow` 的标签与价格文案，去除旧“免费/付费”字样，增加会员专区标识。
4. Program A/B 补充过滤条件、价格逻辑及 JSON-LD 五维字段；Program B 添加会员 9 折 priceSpecification。
5. 如新增 jsonld 工具函数，放置于 `src/utils/jsonld/` 目录，复用课程与 Program 的五维构造；若保留组件内生成，确保 computed 返回值被模板消费避免未使用警告。
6. 运行 `npm run type-check` 与 `npm run build:check` 进行验收；无法执行时在提交说明标注原因。

## 7. 风险与回滚
- 风险：新增字段未在类型中声明导致 TS 报错；slug 生成冲突。
- 缓解：同步更新 `Course`/`Offer` 类型；保持 `generateCourseSlug` 调用；新增课程命名避免与现有重复。
- 回滚：若会员专区过滤影响现有筛选，可临时关闭 `audienceType==='会员专区'` 分支，仅保留 Intermediate 展示。
