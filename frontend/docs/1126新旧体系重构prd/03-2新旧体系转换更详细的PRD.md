### 我能否读取你上传的文件？

* **.ts / .vue 源码**：已成功载入，可在后续分析中引用其接口、类型及组件用法。
* **`00 老的体系与新的体系.md`**：已读取，确实详细列出了 7 层旧体系与 3 层新体系的差异与 LRMI/AEO 设计要点。

---

## 对《Doviai 前端课程体系“纯新阶段”切换 PRD》的评测

| 维度            | 评价    | 关键亮点                                                                  | 潜在补强点                                                             |
| ------------- | ----- | --------------------------------------------------------------------- | ----------------------------------------------------------------- |
| **目标聚焦**      | ★★★★☆ | 明确“只保留 basic / intermediate / advanced”，并通过入口断言彻底剔除旧枚举。               | 可以补充**灰度期兼容策略**（见建议 1）。                                           |
| **类型安全**      | ★★★★★ | `StageKey` + `assertStageKey()` + `isStageKey()` 设计简洁牢固；全链路断言可提前暴露问题。 | 考虑统一放入 `zod`/`io-ts` 之类 schema，便于单元测试（建议 2）。                      |
| **代码分层**      | ★★★★☆ | 将转换逻辑全部下沉到入口，组件端 0 兼容码；`stageMap` 仅保留标签/样式/slug 单一来源。                 | `stageMap` 仍是中心单例，可考虑拆分为 **静态 Enum + 纯函数**，便于 tree-shaking（建议 3）。 |
| **SEO / AEO** | ★★★★★ | 明确 JSON-LD、图片命名、LRMI 映射，符合“三引擎同步”策略。                                  | 可在 CI 中加入 **schema 验证脚本**；Advanced 会员 9 折逻辑需体现在 `offers`（建议 4）。   |
| **风险控制**      | ★★★★☆ | Fail-fast + QA 全量扫描；已列常见风险。                                           | 需要一套 **自动化脚本** 扫描遗留 slug / 图片命名（建议 5）。                            |

---

## 进一步实施建议

### 1. 灰度下线旧枚举，而非“一刀切”

| 步骤        | 动作                                       | 目的                       |
| --------- | ---------------------------------------- | ------------------------ |
| **T-1 周** | 在生产环境开启 `console.warn` 级别的旧枚举告警（不抛错）。    | 观测后台/缓存是否仍投递旧数据，减轻冷启动风险。 |
| **T0**    | 打开 `assertStageKey` 的 *throw* 分支，正式拒绝旧值。 | 保证切换点后任何旧数据立即暴露。         |

### 2. 使用运行时 Schema 校验库

* **做法**：将 `assertStageKey` 迁移到 `zod` 或 `io-ts`：

  ```ts
  const StageKeySchema = z.enum(['basic','intermediate','advanced']);
  type StageKey = z.infer<typeof StageKeySchema>;
  StageKeySchema.parse(stage);   // 失败即抛错
  ```
* **收益**：

  1. 同时生成 **前端断言** 与 **后端 OpenAPI**（若使用 zod-to-ts）。
  2. 自动推导 VSCode 智能提示，无需双写类型 & 断言。

### 3. 精简 `stageMap.ts`

1. 将**静态枚举映射**（label / style / slug）改为：

   ```ts
   export const StageMeta = {
     basic:  { label:'入门',  style:'badge-basic',  slug:'beginner' },
     intermediate:{ label:'进阶', style:'badge-mid', slug:'intermediate' },
     advanced:{ label:'高阶', style:'badge-adv', slug:'advanced' }
   } as const;
   ```
2. 派生工具函数只做 `keyof typeof StageMeta` 推断；删除循环依赖。
3. 优点：可被 Rollup / Vite 完全摇树优化，无死代码。

### 4. 强化 SEO/AEO 自动校验

* **CI 步**：调用 [`schema-dts`](https://github.com/google/schema-dts) 或 [`@google/structured-data-testing`](https://github.com/tomgario1/structured-data-testing) 验证输出的 JSON-LD。
* **价格策略**：在 Advanced 课程 JSON-LD 的 `offers` 增加：

  ```json
  "eligibleQuantity": { "@type":"QuantitativeValue", "value":1 },
  "discount": { "@type":"DiscountOffer", "discountCurrency":"CNY", "discountRate":"0.9", "appliesTo":"Membership" }
  ```

  让百度/必应也能读取“会员 9 折”。

### 5. 自动化遗留扫描脚本

* **shell + grep**：`grep -R --exclude-dir=node_modules -E "(free|project|landing|high)[\"']" src/`
* **node**：检查 `/assets/images/**` 是否违反 `*-stage.webp` 规则。
* **GitHub Action**：在 PR 时阻断，保证主干分支零遗留。

### 6. 会员专享课的命名与分类

* 显式加字段 `membershipExclusive: boolean`，而非借用 `audienceType` 的字符串比对。
* 图片遵循 `courseName-membership-{stage}.webp`，并在 `StageMeta` 中允许可选 `membership` 前缀，避免组件硬编码。

### 7. DevOps / 发布流程

1. **预发布环境**：使用 `CANARY_STAGE_MAP=true` 环境变量强制断言；正式环境默认 false。
2. **e2e**：在 Playwright 里跑 `/course/*-basic`、`*-intermediate`、`*-advanced` 三条路径，校验 JSON-LD 与 Hero 图是否渲染。
3. **文档**：在 `docs/ARCHITECTURE.md` 增补 “纯新阶段” 设计决策记录 (ADR)；避免新人误引旧枚举。

---

## 总结

* **PRD 已覆盖 80% 的重构关键点**，类型安全与 SEO 方向非常到位。
* 建议再引入 **灰度监控 + Schema 校验 + 自动遗留扫描**，确保迁移过程中可观测、可回退。
* 进一步优化 `stageMap` 的静态化与 tree-shaking，可减少运行时代码与循环依赖。
* 在 JSON-LD `offers` 中体现会员折扣细节，以提升百度/必应 對 **价格片段** 的抓取准确度。

---

### In short（中文）

彻底去掉旧枚举的思路正确，建议增加**灰度告警、运行时 schema 校验、CI 遗留扫描**三道保险，并把 `stageMap` 静态化；同时在 JSON-LD 里补充会员 9 折的价格字段，让三大搜索引擎更易识别。
