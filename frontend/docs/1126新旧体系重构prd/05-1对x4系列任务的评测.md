# 04 系列要求符合度评测（x05 交付版）

## 评测结论

- ✅ **核心收敛到纯新三级体系**：`StageKeySchema` + `assertStageKey` 已在类型层与运行时双重校验，`StageMeta` 只保留 basic / intermediate / advanced，无任何旧枚举回落。
- ✅ **数据入口 Fail-fast**：`courseStore` 的 `getCoursesByStage` 已收紧为 `StageKey` 并强制断言，符合 04-1 的“入口即校验”要求。
- ✅ **JSON-LD 构建链已补齐**：新增 `buildCourseJsonLd`/`buildProgramJsonLd` 工具并在课程详情页落地，AEO 五维+会员 9 折均覆盖。
- ⚠️ **Program 页面仍缺 JSON-LD 集成**：虽然已有 Program 构建器，但 `ProgramA/B` 视图未调用，未完成 04-1 Checklist 第 4 条。
- ⚠️ **E2E 阶段验证挂起**：CI 已加入类型检查、遗留扫描和构建，但 Playwright 任务被 `if: false` 禁用，未完全满足 04-2 §7 的“schema/Playwright”闭环。

## 逐项对照

| 04* 要求 | 当前实现 | 结论 |
| --- | --- | --- |
| 删除 legacy 映射，仅保留新版 `StageMeta` | `stageMap.ts` 仅导出 `StageMeta` + get 系列，无 fallback | ✅【F:frontend/src/utils/stageMap.ts†L1-L92】 |
| 所有 stage 入口使用 `StageKey` + `assertStageKey` | `StageKeySchema` 定义 + `courseStore.getCoursesByStage` 断言 | ✅【F:frontend/src/types/index.ts†L7-L38】【F:frontend/src/store/courseStore.ts†L200-L211】 |
| JSON-LD 构建工具落地并校验 stage | `buildCourseJsonLd`/`buildProgramJsonLd` 首行断言；课程详情页已输出 JSON-LD script | ✅【F:frontend/src/utils/jsonld/buildCourseJsonLd.ts†L13-L168】【F:frontend/src/utils/jsonld/buildProgramJsonLd.ts†L7-L126】【F:frontend/src/views/CourseDetails.vue†L4-L167】 |
| Program 视图使用统一 JSON-LD 构建器 | `ProgramAView.vue` 未引入或渲染 JSON-LD | ⚠️【F:frontend/src/views/program/ProgramAView.vue†L1-L80】 |
| CI 包含 legacy 扫描 + schema/Playwright 校验 | `pure-stage.yml` 已含 type-check/scan/build，但 Playwright job 处于禁用状态 | ⚠️【F:.github/workflows/pure-stage.yml†L1-L178】 |

## 建议补差

1. 在 `frontend/src/views/program/ProgramAView.vue` 与 `ProgramBView.vue` 引入 `buildProgramJsonLd`，在模板顶部注入 `<script type="application/ld+json">`，补齐 04-1 Checklist 第 4 条。
2. 取消 CI 中 `e2e` job 的 `if: false`，或改为受环境变量控制，确保 04-2 §7 的 Playwright 验证可执行。

